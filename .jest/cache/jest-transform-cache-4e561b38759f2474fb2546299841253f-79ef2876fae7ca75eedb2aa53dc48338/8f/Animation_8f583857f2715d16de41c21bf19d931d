b8eb85caa5cc4f5cc5943221f7f46e8f
var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");
Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;
var _toConsumableArray2 = _interopRequireDefault(require("@babel/runtime/helpers/toConsumableArray"));
var _classCallCheck2 = _interopRequireDefault(require("@babel/runtime/helpers/classCallCheck"));
var _createClass2 = _interopRequireDefault(require("@babel/runtime/helpers/createClass"));
var _classPrivateFieldLooseBase2 = _interopRequireDefault(require("@babel/runtime/helpers/classPrivateFieldLooseBase"));
var _classPrivateFieldLooseKey2 = _interopRequireDefault(require("@babel/runtime/helpers/classPrivateFieldLooseKey"));
var _NativeAnimatedHelper = _interopRequireDefault(require("../../../src/private/animated/NativeAnimatedHelper"));
var ReactNativeFeatureFlags = _interopRequireWildcard(require("../../../src/private/featureflags/ReactNativeFeatureFlags"));
var _AnimatedProps = _interopRequireDefault(require("../nodes/AnimatedProps"));
function _interopRequireWildcard(e, t) { if ("function" == typeof WeakMap) var r = new WeakMap(), n = new WeakMap(); return (_interopRequireWildcard = function _interopRequireWildcard(e, t) { if (!t && e && e.__esModule) return e; var o, i, f = { __proto__: null, default: e }; if (null === e || "object" != typeof e && "function" != typeof e) return f; if (o = t ? n : r) { if (o.has(e)) return o.get(e); o.set(e, f); } for (var _t in e) "default" !== _t && {}.hasOwnProperty.call(e, _t) && ((i = (o = Object.defineProperty) && Object.getOwnPropertyDescriptor(e, _t)) && (i.get || i.set) ? o(f, _t, i) : f[_t] = e[_t]); return f; })(e, t); }
var startNativeAnimationNextId = 1;
var _nativeID = (0, _classPrivateFieldLooseKey2.default)("nativeID");
var _onEnd = (0, _classPrivateFieldLooseKey2.default)("onEnd");
var _useNativeDriver = (0, _classPrivateFieldLooseKey2.default)("useNativeDriver");
var Animation = exports.default = function () {
  function Animation(config) {
    var _config$isInteraction, _config$iterations;
    (0, _classCallCheck2.default)(this, Animation);
    Object.defineProperty(this, _nativeID, {
      writable: true,
      value: void 0
    });
    Object.defineProperty(this, _onEnd, {
      writable: true,
      value: void 0
    });
    Object.defineProperty(this, _useNativeDriver, {
      writable: true,
      value: void 0
    });
    (0, _classPrivateFieldLooseBase2.default)(this, _useNativeDriver)[_useNativeDriver] = _NativeAnimatedHelper.default.shouldUseNativeDriver(config);
    this.__active = false;
    this.__isInteraction = (_config$isInteraction = config.isInteraction) != null ? _config$isInteraction : !(0, _classPrivateFieldLooseBase2.default)(this, _useNativeDriver)[_useNativeDriver];
    this.__isLooping = config.isLooping;
    this.__iterations = (_config$iterations = config.iterations) != null ? _config$iterations : 1;
    if (__DEV__) {
      this.__debugID = config.debugID;
    }
  }
  return (0, _createClass2.default)(Animation, [{
    key: "start",
    value: function start(fromValue, onUpdate, onEnd, previousAnimation, animatedValue) {
      if (!(0, _classPrivateFieldLooseBase2.default)(this, _useNativeDriver)[_useNativeDriver] && animatedValue.__isNative === true) {
        throw new Error('Attempting to run JS driven animation on animated node ' + 'that has been moved to "native" earlier by starting an ' + 'animation with `useNativeDriver: true`');
      }
      (0, _classPrivateFieldLooseBase2.default)(this, _onEnd)[_onEnd] = onEnd;
      this.__active = true;
    }
  }, {
    key: "stop",
    value: function stop() {
      if ((0, _classPrivateFieldLooseBase2.default)(this, _nativeID)[_nativeID] != null) {
        var nativeID = (0, _classPrivateFieldLooseBase2.default)(this, _nativeID)[_nativeID];
        var identifier = `${nativeID}:stopAnimation`;
        try {
          _NativeAnimatedHelper.default.API.setWaitingForIdentifier(identifier);
          _NativeAnimatedHelper.default.API.stopAnimation(nativeID);
        } finally {
          _NativeAnimatedHelper.default.API.unsetWaitingForIdentifier(identifier);
        }
      }
      this.__active = false;
    }
  }, {
    key: "__getNativeAnimationConfig",
    value: function __getNativeAnimationConfig() {
      throw new Error('This animation type cannot be offloaded to native');
    }
  }, {
    key: "__findAnimatedPropsNodes",
    value: function __findAnimatedPropsNodes(node) {
      var result = [];
      if (node instanceof _AnimatedProps.default) {
        result.push(node);
        return result;
      }
      for (var child of node.__getChildren()) {
        result.push.apply(result, (0, _toConsumableArray2.default)(this.__findAnimatedPropsNodes(child)));
      }
      return result;
    }
  }, {
    key: "__startAnimationIfNative",
    value: function __startAnimationIfNative(animatedValue) {
      var _this = this;
      if (!(0, _classPrivateFieldLooseBase2.default)(this, _useNativeDriver)[_useNativeDriver]) {
        return false;
      }
      var startNativeAnimationWaitId = `${startNativeAnimationNextId}:startAnimation`;
      startNativeAnimationNextId += 1;
      _NativeAnimatedHelper.default.API.setWaitingForIdentifier(startNativeAnimationWaitId);
      try {
        var config = this.__getNativeAnimationConfig();
        animatedValue.__makeNative(config.platformConfig);
        (0, _classPrivateFieldLooseBase2.default)(this, _nativeID)[_nativeID] = _NativeAnimatedHelper.default.generateNewAnimationId();
        _NativeAnimatedHelper.default.API.startAnimatingNode((0, _classPrivateFieldLooseBase2.default)(this, _nativeID)[_nativeID], animatedValue.__getNativeTag(), config, function (result) {
          _this.__notifyAnimationEnd(result);
          var value = result.value,
            offset = result.offset;
          if (value != null) {
            animatedValue.__onAnimatedValueUpdateReceived(value, offset);
            if (!(ReactNativeFeatureFlags.cxxNativeAnimatedEnabled() && ReactNativeFeatureFlags.cxxNativeAnimatedRemoveJsSync())) {
              if (_this.__isLooping === true) {
                return;
              }
            }
            _this.__findAnimatedPropsNodes(animatedValue).forEach(function (node) {
              return node.update();
            });
          }
        });
        return true;
      } catch (e) {
        throw e;
      } finally {
        _NativeAnimatedHelper.default.API.unsetWaitingForIdentifier(startNativeAnimationWaitId);
      }
    }
  }, {
    key: "__notifyAnimationEnd",
    value: function __notifyAnimationEnd(result) {
      var callback = (0, _classPrivateFieldLooseBase2.default)(this, _onEnd)[_onEnd];
      if (callback != null) {
        (0, _classPrivateFieldLooseBase2.default)(this, _onEnd)[_onEnd] = null;
        callback(result);
      }
    }
  }, {
    key: "__getDebugID",
    value: function __getDebugID() {
      if (__DEV__) {
        return this.__debugID;
      }
      return undefined;
    }
  }]);
}();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfTmF0aXZlQW5pbWF0ZWRIZWxwZXIiLCJfaW50ZXJvcFJlcXVpcmVEZWZhdWx0IiwicmVxdWlyZSIsIlJlYWN0TmF0aXZlRmVhdHVyZUZsYWdzIiwiX2ludGVyb3BSZXF1aXJlV2lsZGNhcmQiLCJfQW5pbWF0ZWRQcm9wcyIsImUiLCJ0IiwiV2Vha01hcCIsInIiLCJuIiwiX19lc01vZHVsZSIsIm8iLCJpIiwiZiIsIl9fcHJvdG9fXyIsImRlZmF1bHQiLCJoYXMiLCJnZXQiLCJzZXQiLCJfdCIsImhhc093blByb3BlcnR5IiwiY2FsbCIsIk9iamVjdCIsImRlZmluZVByb3BlcnR5IiwiZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yIiwic3RhcnROYXRpdmVBbmltYXRpb25OZXh0SWQiLCJfbmF0aXZlSUQiLCJfY2xhc3NQcml2YXRlRmllbGRMb29zZUtleTIiLCJfb25FbmQiLCJfdXNlTmF0aXZlRHJpdmVyIiwiQW5pbWF0aW9uIiwiZXhwb3J0cyIsImNvbmZpZyIsIl9jb25maWckaXNJbnRlcmFjdGlvbiIsIl9jb25maWckaXRlcmF0aW9ucyIsIl9jbGFzc0NhbGxDaGVjazIiLCJ3cml0YWJsZSIsInZhbHVlIiwiX2NsYXNzUHJpdmF0ZUZpZWxkTG9vc2VCYXNlMiIsIk5hdGl2ZUFuaW1hdGVkSGVscGVyIiwic2hvdWxkVXNlTmF0aXZlRHJpdmVyIiwiX19hY3RpdmUiLCJfX2lzSW50ZXJhY3Rpb24iLCJpc0ludGVyYWN0aW9uIiwiX19pc0xvb3BpbmciLCJpc0xvb3BpbmciLCJfX2l0ZXJhdGlvbnMiLCJpdGVyYXRpb25zIiwiX19ERVZfXyIsIl9fZGVidWdJRCIsImRlYnVnSUQiLCJfY3JlYXRlQ2xhc3MyIiwia2V5Iiwic3RhcnQiLCJmcm9tVmFsdWUiLCJvblVwZGF0ZSIsIm9uRW5kIiwicHJldmlvdXNBbmltYXRpb24iLCJhbmltYXRlZFZhbHVlIiwiX19pc05hdGl2ZSIsIkVycm9yIiwic3RvcCIsIm5hdGl2ZUlEIiwiaWRlbnRpZmllciIsIkFQSSIsInNldFdhaXRpbmdGb3JJZGVudGlmaWVyIiwic3RvcEFuaW1hdGlvbiIsInVuc2V0V2FpdGluZ0ZvcklkZW50aWZpZXIiLCJfX2dldE5hdGl2ZUFuaW1hdGlvbkNvbmZpZyIsIl9fZmluZEFuaW1hdGVkUHJvcHNOb2RlcyIsIm5vZGUiLCJyZXN1bHQiLCJBbmltYXRlZFByb3BzIiwicHVzaCIsImNoaWxkIiwiX19nZXRDaGlsZHJlbiIsImFwcGx5IiwiX3RvQ29uc3VtYWJsZUFycmF5MiIsIl9fc3RhcnRBbmltYXRpb25JZk5hdGl2ZSIsIl90aGlzIiwic3RhcnROYXRpdmVBbmltYXRpb25XYWl0SWQiLCJfX21ha2VOYXRpdmUiLCJwbGF0Zm9ybUNvbmZpZyIsImdlbmVyYXRlTmV3QW5pbWF0aW9uSWQiLCJzdGFydEFuaW1hdGluZ05vZGUiLCJfX2dldE5hdGl2ZVRhZyIsIl9fbm90aWZ5QW5pbWF0aW9uRW5kIiwib2Zmc2V0IiwiX19vbkFuaW1hdGVkVmFsdWVVcGRhdGVSZWNlaXZlZCIsImN4eE5hdGl2ZUFuaW1hdGVkRW5hYmxlZCIsImN4eE5hdGl2ZUFuaW1hdGVkUmVtb3ZlSnNTeW5jIiwiZm9yRWFjaCIsInVwZGF0ZSIsImNhbGxiYWNrIiwiX19nZXREZWJ1Z0lEIiwidW5kZWZpbmVkIl0sInNvdXJjZXMiOlsiQW5pbWF0aW9uLmpzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQ29weXJpZ2h0IChjKSBNZXRhIFBsYXRmb3JtcywgSW5jLiBhbmQgYWZmaWxpYXRlcy5cbiAqXG4gKiBUaGlzIHNvdXJjZSBjb2RlIGlzIGxpY2Vuc2VkIHVuZGVyIHRoZSBNSVQgbGljZW5zZSBmb3VuZCBpbiB0aGVcbiAqIExJQ0VOU0UgZmlsZSBpbiB0aGUgcm9vdCBkaXJlY3Rvcnkgb2YgdGhpcyBzb3VyY2UgdHJlZS5cbiAqXG4gKiBAZmxvdyBzdHJpY3QtbG9jYWxcbiAqIEBmb3JtYXRcbiAqL1xuXG5pbXBvcnQgdHlwZSB7UGxhdGZvcm1Db25maWd9IGZyb20gJy4uL0FuaW1hdGVkUGxhdGZvcm1Db25maWcnO1xuaW1wb3J0IHR5cGUgQW5pbWF0ZWROb2RlIGZyb20gJy4uL25vZGVzL0FuaW1hdGVkTm9kZSc7XG5pbXBvcnQgdHlwZSBBbmltYXRlZFZhbHVlIGZyb20gJy4uL25vZGVzL0FuaW1hdGVkVmFsdWUnO1xuXG5pbXBvcnQgTmF0aXZlQW5pbWF0ZWRIZWxwZXIgZnJvbSAnLi4vLi4vLi4vc3JjL3ByaXZhdGUvYW5pbWF0ZWQvTmF0aXZlQW5pbWF0ZWRIZWxwZXInO1xuaW1wb3J0ICogYXMgUmVhY3ROYXRpdmVGZWF0dXJlRmxhZ3MgZnJvbSAnLi4vLi4vLi4vc3JjL3ByaXZhdGUvZmVhdHVyZWZsYWdzL1JlYWN0TmF0aXZlRmVhdHVyZUZsYWdzJztcbmltcG9ydCBBbmltYXRlZFByb3BzIGZyb20gJy4uL25vZGVzL0FuaW1hdGVkUHJvcHMnO1xuXG5leHBvcnQgdHlwZSBFbmRSZXN1bHQgPSB7XG4gIGZpbmlzaGVkOiBib29sZWFuLFxuICB2YWx1ZT86IG51bWJlcixcbiAgb2Zmc2V0PzogbnVtYmVyLFxuICAuLi5cbn07XG5leHBvcnQgdHlwZSBFbmRDYWxsYmFjayA9IChyZXN1bHQ6IEVuZFJlc3VsdCkgPT4gdm9pZDtcblxuZXhwb3J0IHR5cGUgQW5pbWF0aW9uQ29uZmlnID0gJFJlYWRPbmx5PHtcbiAgaXNJbnRlcmFjdGlvbj86IGJvb2xlYW4sXG4gIHVzZU5hdGl2ZURyaXZlcjogYm9vbGVhbixcbiAgcGxhdGZvcm1Db25maWc/OiBQbGF0Zm9ybUNvbmZpZyxcbiAgb25Db21wbGV0ZT86ID9FbmRDYWxsYmFjayxcbiAgaXRlcmF0aW9ucz86IG51bWJlcixcbiAgaXNMb29waW5nPzogYm9vbGVhbixcbiAgZGVidWdJRD86ID9zdHJpbmcsXG4gIC4uLlxufT47XG5cbmxldCBzdGFydE5hdGl2ZUFuaW1hdGlvbk5leHRJZCA9IDE7XG5cbi8vIEltcG9ydGFudCBub3RlOiBzdGFydCgpIGFuZCBzdG9wKCkgd2lsbCBvbmx5IGJlIGNhbGxlZCBhdCBtb3N0IG9uY2UuXG4vLyBPbmNlIGFuIGFuaW1hdGlvbiBoYXMgYmVlbiBzdG9wcGVkIG9yIGZpbmlzaGVkIGl0cyBjb3Vyc2UsIGl0IHdpbGxcbi8vIG5vdCBiZSByZXVzZWQuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBBbmltYXRpb24ge1xuICAjbmF0aXZlSUQ6ID9udW1iZXI7XG4gICNvbkVuZDogP0VuZENhbGxiYWNrO1xuICAjdXNlTmF0aXZlRHJpdmVyOiBib29sZWFuO1xuXG4gIF9fYWN0aXZlOiBib29sZWFuO1xuICBfX2lzSW50ZXJhY3Rpb246IGJvb2xlYW47XG4gIF9faXNMb29waW5nOiA/Ym9vbGVhbjtcbiAgX19pdGVyYXRpb25zOiBudW1iZXI7XG4gIF9fZGVidWdJRDogP3N0cmluZztcblxuICBjb25zdHJ1Y3Rvcihjb25maWc6IEFuaW1hdGlvbkNvbmZpZykge1xuICAgIHRoaXMuI3VzZU5hdGl2ZURyaXZlciA9IE5hdGl2ZUFuaW1hdGVkSGVscGVyLnNob3VsZFVzZU5hdGl2ZURyaXZlcihjb25maWcpO1xuXG4gICAgdGhpcy5fX2FjdGl2ZSA9IGZhbHNlO1xuICAgIHRoaXMuX19pc0ludGVyYWN0aW9uID0gY29uZmlnLmlzSW50ZXJhY3Rpb24gPz8gIXRoaXMuI3VzZU5hdGl2ZURyaXZlcjtcbiAgICB0aGlzLl9faXNMb29waW5nID0gY29uZmlnLmlzTG9vcGluZztcbiAgICB0aGlzLl9faXRlcmF0aW9ucyA9IGNvbmZpZy5pdGVyYXRpb25zID8/IDE7XG4gICAgaWYgKF9fREVWX18pIHtcbiAgICAgIHRoaXMuX19kZWJ1Z0lEID0gY29uZmlnLmRlYnVnSUQ7XG4gICAgfVxuICB9XG5cbiAgc3RhcnQoXG4gICAgZnJvbVZhbHVlOiBudW1iZXIsXG4gICAgb25VcGRhdGU6ICh2YWx1ZTogbnVtYmVyKSA9PiB2b2lkLFxuICAgIG9uRW5kOiA/RW5kQ2FsbGJhY2ssXG4gICAgcHJldmlvdXNBbmltYXRpb246ID9BbmltYXRpb24sXG4gICAgYW5pbWF0ZWRWYWx1ZTogQW5pbWF0ZWRWYWx1ZSxcbiAgKTogdm9pZCB7XG4gICAgaWYgKCF0aGlzLiN1c2VOYXRpdmVEcml2ZXIgJiYgYW5pbWF0ZWRWYWx1ZS5fX2lzTmF0aXZlID09PSB0cnVlKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICAgICdBdHRlbXB0aW5nIHRvIHJ1biBKUyBkcml2ZW4gYW5pbWF0aW9uIG9uIGFuaW1hdGVkIG5vZGUgJyArXG4gICAgICAgICAgJ3RoYXQgaGFzIGJlZW4gbW92ZWQgdG8gXCJuYXRpdmVcIiBlYXJsaWVyIGJ5IHN0YXJ0aW5nIGFuICcgK1xuICAgICAgICAgICdhbmltYXRpb24gd2l0aCBgdXNlTmF0aXZlRHJpdmVyOiB0cnVlYCcsXG4gICAgICApO1xuICAgIH1cblxuICAgIHRoaXMuI29uRW5kID0gb25FbmQ7XG4gICAgdGhpcy5fX2FjdGl2ZSA9IHRydWU7XG4gIH1cblxuICBzdG9wKCk6IHZvaWQge1xuICAgIGlmICh0aGlzLiNuYXRpdmVJRCAhPSBudWxsKSB7XG4gICAgICBjb25zdCBuYXRpdmVJRCA9IHRoaXMuI25hdGl2ZUlEO1xuICAgICAgY29uc3QgaWRlbnRpZmllciA9IGAke25hdGl2ZUlEfTpzdG9wQW5pbWF0aW9uYDtcbiAgICAgIHRyeSB7XG4gICAgICAgIC8vIFRoaXMgaXMgb25seSByZXF1aXJlZCB3aGVuIHNpbmdsZU9wQmF0Y2hpbmcgaXMgdXNlZCwgYXMgb3RoZXJ3aXNlXG4gICAgICAgIC8vIHdlIGZsdXNoIGNhbGxzIGltbWVkaWF0ZWx5IHdoZW4gdGhlcmUncyBubyBwZW5kaW5nIHF1ZXVlLlxuICAgICAgICBOYXRpdmVBbmltYXRlZEhlbHBlci5BUEkuc2V0V2FpdGluZ0ZvcklkZW50aWZpZXIoaWRlbnRpZmllcik7XG4gICAgICAgIE5hdGl2ZUFuaW1hdGVkSGVscGVyLkFQSS5zdG9wQW5pbWF0aW9uKG5hdGl2ZUlEKTtcbiAgICAgIH0gZmluYWxseSB7XG4gICAgICAgIE5hdGl2ZUFuaW1hdGVkSGVscGVyLkFQSS51bnNldFdhaXRpbmdGb3JJZGVudGlmaWVyKGlkZW50aWZpZXIpO1xuICAgICAgfVxuICAgIH1cbiAgICB0aGlzLl9fYWN0aXZlID0gZmFsc2U7XG4gIH1cblxuICBfX2dldE5hdGl2ZUFuaW1hdGlvbkNvbmZpZygpOiAkUmVhZE9ubHk8e1xuICAgIHBsYXRmb3JtQ29uZmlnOiA/UGxhdGZvcm1Db25maWcsXG4gICAgLi4uXG4gIH0+IHtcbiAgICAvLyBTdWJjbGFzc2VzIHRoYXQgaGF2ZSBjb3JyZXNwb25kaW5nIGFuaW1hdGlvbiBpbXBsZW1lbnRhdGlvbiBkb25lIGluIG5hdGl2ZVxuICAgIC8vIHNob3VsZCBvdmVycmlkZSB0aGlzIG1ldGhvZFxuICAgIHRocm93IG5ldyBFcnJvcignVGhpcyBhbmltYXRpb24gdHlwZSBjYW5ub3QgYmUgb2ZmbG9hZGVkIHRvIG5hdGl2ZScpO1xuICB9XG5cbiAgX19maW5kQW5pbWF0ZWRQcm9wc05vZGVzKG5vZGU6IEFuaW1hdGVkTm9kZSk6IEFycmF5PEFuaW1hdGVkUHJvcHM+IHtcbiAgICBjb25zdCByZXN1bHQgPSBbXTtcblxuICAgIGlmIChub2RlIGluc3RhbmNlb2YgQW5pbWF0ZWRQcm9wcykge1xuICAgICAgcmVzdWx0LnB1c2gobm9kZSk7XG4gICAgICByZXR1cm4gcmVzdWx0O1xuICAgIH1cblxuICAgIGZvciAoY29uc3QgY2hpbGQgb2Ygbm9kZS5fX2dldENoaWxkcmVuKCkpIHtcbiAgICAgIHJlc3VsdC5wdXNoKC4uLnRoaXMuX19maW5kQW5pbWF0ZWRQcm9wc05vZGVzKGNoaWxkKSk7XG4gICAgfVxuXG4gICAgcmV0dXJuIHJlc3VsdDtcbiAgfVxuXG4gIF9fc3RhcnRBbmltYXRpb25JZk5hdGl2ZShhbmltYXRlZFZhbHVlOiBBbmltYXRlZFZhbHVlKTogYm9vbGVhbiB7XG4gICAgaWYgKCF0aGlzLiN1c2VOYXRpdmVEcml2ZXIpIHtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG5cbiAgICBjb25zdCBzdGFydE5hdGl2ZUFuaW1hdGlvbldhaXRJZCA9IGAke3N0YXJ0TmF0aXZlQW5pbWF0aW9uTmV4dElkfTpzdGFydEFuaW1hdGlvbmA7XG4gICAgc3RhcnROYXRpdmVBbmltYXRpb25OZXh0SWQgKz0gMTtcbiAgICBOYXRpdmVBbmltYXRlZEhlbHBlci5BUEkuc2V0V2FpdGluZ0ZvcklkZW50aWZpZXIoXG4gICAgICBzdGFydE5hdGl2ZUFuaW1hdGlvbldhaXRJZCxcbiAgICApO1xuICAgIHRyeSB7XG4gICAgICBjb25zdCBjb25maWcgPSB0aGlzLl9fZ2V0TmF0aXZlQW5pbWF0aW9uQ29uZmlnKCk7XG4gICAgICBhbmltYXRlZFZhbHVlLl9fbWFrZU5hdGl2ZShjb25maWcucGxhdGZvcm1Db25maWcpO1xuICAgICAgdGhpcy4jbmF0aXZlSUQgPSBOYXRpdmVBbmltYXRlZEhlbHBlci5nZW5lcmF0ZU5ld0FuaW1hdGlvbklkKCk7XG4gICAgICBOYXRpdmVBbmltYXRlZEhlbHBlci5BUEkuc3RhcnRBbmltYXRpbmdOb2RlKFxuICAgICAgICB0aGlzLiNuYXRpdmVJRCxcbiAgICAgICAgYW5pbWF0ZWRWYWx1ZS5fX2dldE5hdGl2ZVRhZygpLFxuICAgICAgICBjb25maWcsXG4gICAgICAgIHJlc3VsdCA9PiB7XG4gICAgICAgICAgdGhpcy5fX25vdGlmeUFuaW1hdGlvbkVuZChyZXN1bHQpO1xuXG4gICAgICAgICAgLy8gV2hlbiB1c2luZyBuYXRpdmVseSBkcml2ZW4gYW5pbWF0aW9ucywgb25jZSB0aGUgYW5pbWF0aW9uIGNvbXBsZXRlcyxcbiAgICAgICAgICAvLyB3ZSBuZWVkIHRvIGVuc3VyZSB0aGF0IHRoZSBKUyBzaWRlIG5vZGVzIGFyZSBzeW5jZWQgd2l0aCB0aGUgdXBkYXRlZFxuICAgICAgICAgIC8vIHZhbHVlcy5cbiAgICAgICAgICBjb25zdCB7dmFsdWUsIG9mZnNldH0gPSByZXN1bHQ7XG4gICAgICAgICAgaWYgKHZhbHVlICE9IG51bGwpIHtcbiAgICAgICAgICAgIGFuaW1hdGVkVmFsdWUuX19vbkFuaW1hdGVkVmFsdWVVcGRhdGVSZWNlaXZlZCh2YWx1ZSwgb2Zmc2V0KTtcblxuICAgICAgICAgICAgaWYgKFxuICAgICAgICAgICAgICAhKFxuICAgICAgICAgICAgICAgIFJlYWN0TmF0aXZlRmVhdHVyZUZsYWdzLmN4eE5hdGl2ZUFuaW1hdGVkRW5hYmxlZCgpICYmXG4gICAgICAgICAgICAgICAgUmVhY3ROYXRpdmVGZWF0dXJlRmxhZ3MuY3h4TmF0aXZlQW5pbWF0ZWRSZW1vdmVKc1N5bmMoKVxuICAgICAgICAgICAgICApXG4gICAgICAgICAgICApIHtcbiAgICAgICAgICAgICAgaWYgKHRoaXMuX19pc0xvb3BpbmcgPT09IHRydWUpIHtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gT25jZSB0aGUgSlMgc2lkZSBub2RlIGlzIHN5bmNlZCB3aXRoIHRoZSB1cGRhdGVkIHZhbHVlcywgdHJpZ2dlciBhblxuICAgICAgICAgICAgLy8gdXBkYXRlIG9uIHRoZSBBbmltYXRlZFByb3BzIG5vZGVzIHRvIGNhbGwgYW55IHJlZ2lzdGVyZWQgY2FsbGJhY2tzLlxuICAgICAgICAgICAgdGhpcy5fX2ZpbmRBbmltYXRlZFByb3BzTm9kZXMoYW5pbWF0ZWRWYWx1ZSkuZm9yRWFjaChub2RlID0+XG4gICAgICAgICAgICAgIG5vZGUudXBkYXRlKCksXG4gICAgICAgICAgICApO1xuICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICk7XG5cbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgIHRocm93IGU7XG4gICAgfSBmaW5hbGx5IHtcbiAgICAgIE5hdGl2ZUFuaW1hdGVkSGVscGVyLkFQSS51bnNldFdhaXRpbmdGb3JJZGVudGlmaWVyKFxuICAgICAgICBzdGFydE5hdGl2ZUFuaW1hdGlvbldhaXRJZCxcbiAgICAgICk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIE5vdGlmeSB0aGUgY29tcGxldGlvbiBjYWxsYmFjayB0aGF0IHRoZSBhbmltYXRpb24gaGFzIGVuZGVkLiBUaGUgY29tcGxldGlvblxuICAgKiBjYWxsYmFjayB3aWxsIG5ldmVyIGJlIGNhbGxlZCBtb3JlIHRoYW4gb25jZS5cbiAgICovXG4gIF9fbm90aWZ5QW5pbWF0aW9uRW5kKHJlc3VsdDogRW5kUmVzdWx0KTogdm9pZCB7XG4gICAgY29uc3QgY2FsbGJhY2sgPSB0aGlzLiNvbkVuZDtcbiAgICBpZiAoY2FsbGJhY2sgIT0gbnVsbCkge1xuICAgICAgdGhpcy4jb25FbmQgPSBudWxsO1xuICAgICAgY2FsbGJhY2socmVzdWx0KTtcbiAgICB9XG4gIH1cblxuICBfX2dldERlYnVnSUQoKTogP3N0cmluZyB7XG4gICAgaWYgKF9fREVWX18pIHtcbiAgICAgIHJldHVybiB0aGlzLl9fZGVidWdJRDtcbiAgICB9XG4gICAgcmV0dXJuIHVuZGVmaW5lZDtcbiAgfVxufVxuIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7O0FBY0EsSUFBQUEscUJBQUEsR0FBQUMsc0JBQUEsQ0FBQUMsT0FBQTtBQUNBLElBQUFDLHVCQUFBLEdBQUFDLHVCQUFBLENBQUFGLE9BQUE7QUFDQSxJQUFBRyxjQUFBLEdBQUFKLHNCQUFBLENBQUFDLE9BQUE7QUFBbUQsU0FBQUUsd0JBQUFFLENBQUEsRUFBQUMsQ0FBQSw2QkFBQUMsT0FBQSxNQUFBQyxDQUFBLE9BQUFELE9BQUEsSUFBQUUsQ0FBQSxPQUFBRixPQUFBLFlBQUFKLHVCQUFBLFlBQUFBLHdCQUFBRSxDQUFBLEVBQUFDLENBQUEsU0FBQUEsQ0FBQSxJQUFBRCxDQUFBLElBQUFBLENBQUEsQ0FBQUssVUFBQSxTQUFBTCxDQUFBLE1BQUFNLENBQUEsRUFBQUMsQ0FBQSxFQUFBQyxDQUFBLEtBQUFDLFNBQUEsUUFBQUMsT0FBQSxFQUFBVixDQUFBLGlCQUFBQSxDQUFBLHVCQUFBQSxDQUFBLHlCQUFBQSxDQUFBLFNBQUFRLENBQUEsTUFBQUYsQ0FBQSxHQUFBTCxDQUFBLEdBQUFHLENBQUEsR0FBQUQsQ0FBQSxRQUFBRyxDQUFBLENBQUFLLEdBQUEsQ0FBQVgsQ0FBQSxV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