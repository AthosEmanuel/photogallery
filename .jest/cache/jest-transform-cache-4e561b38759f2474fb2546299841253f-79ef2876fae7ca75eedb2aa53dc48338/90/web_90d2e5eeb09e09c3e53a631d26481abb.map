{"version":3,"names":["DEFAULT_OPTIONS","mediaType","includeBase64","selectionLimit","camera","options","arguments","length","undefined","callback","result","errorCode","errorMessage","Promise","resolve","container","document","createElement","wrapper","content","buttons","btnCapture","btnBack","btnSave","btnCancel","video","canvas","currentMediaStream","navigator","mediaDevices","getUserMedia","audio","then","stream","srcObject","play","catch","err","console","log","isAlreadyUsingFontAwesome","getElementsByClassName","isAlreadyInjectedFontAwesome","getElementById","head","getElementsByTagName","link","id","rel","type","href","appendChild","style","cssText","innerHTML","append","body","hasPhoto","handleButtons","stopCamera","removeChild","getTracks","forEach","track","stop","addEventListener","_asyncToGenerator2","default","_canvas$getContext","width","videoWidth","height","videoHeight","getContext","drawImage","_canvas$getContext2","clearRect","uri","toDataURL","asset","assets","didCancel","imageLibrary","input","display","setAttribute","getWebMediaType","inputChangeHandler","_ref4","files","img","readFile","imgs","all","Array","from","map","file","cleanup","apply","inputCancelHandler","_ref5","removeEventListener","event","MouseEvent","dispatchEvent","targetFile","reject","reader","FileReader","onerror","Error","onload","_ref6","target","returnRaw","image","Image","src","_image$naturalWidth","_image$naturalHeight","Object","assign","naturalWidth","naturalHeight","base64","substr","indexOf","readAsDataURL","_webMediaTypes$mediaT","webMediaTypes","photo","mixed"],"sources":["web.ts"],"sourcesContent":["import {\n  CameraOptions,\n  ImageLibraryOptions,\n  Callback,\n  ImagePickerResponse,\n  ErrorCode,\n  Asset,\n  MediaType,\n} from '../types';\n\nconst DEFAULT_OPTIONS: Pick<\n  ImageLibraryOptions & CameraOptions,\n  'mediaType' | 'includeBase64' | 'selectionLimit'\n> = {\n  mediaType: 'photo',\n  includeBase64: false,\n  selectionLimit: 1,\n};\n\nexport function camera(\n  options: CameraOptions = DEFAULT_OPTIONS,\n  callback?: Callback,\n): Promise<ImagePickerResponse> {\n  if (options.mediaType !== 'photo') {\n    const result = {\n      errorCode: 'others' as ErrorCode,\n      errorMessage: 'For now, only photo mediaType is supported for web',\n    }\n\n    if (callback) callback(result);\n\n    return Promise.resolve(result);\n  }\n\n  const container = document.createElement('div');\n  const wrapper = document.createElement('div');\n  const content = document.createElement('div');\n  const buttons = document.createElement('div');\n  const btnCapture = document.createElement('button');\n  const btnBack = document.createElement('button');\n  const btnSave = document.createElement('button');\n  const btnCancel = document.createElement('button');\n  const video = document.createElement('video');\n  const canvas = document.createElement('canvas');\n\n  let currentMediaStream: MediaStream | null = null;\n\n  // init video\n  navigator.mediaDevices.getUserMedia({ audio: false, video: true })\n    .then(stream => {\n      currentMediaStream = stream;\n      video.srcObject = stream;\n      video.play();\n    }).catch(err => {\n      console.log(err);\n    })\n\n  const isAlreadyUsingFontAwesome = !!document.getElementsByClassName('fa').length;\n\n  if (!isAlreadyUsingFontAwesome) {\n    const isAlreadyInjectedFontAwesome = !!document.getElementById('injected-font-awesome');\n    if (!isAlreadyInjectedFontAwesome) { \n      // inject font-awesome\n      const head = document.getElementsByTagName('HEAD')[0];\n      const link = document.createElement('link');\n      link.id = 'injected-font-awesome';\n      link.rel = 'stylesheet';\n      link.type = 'text/css';\n      link.href = 'https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css';\n      head.appendChild(link);\n    }\n  }\n\n  container.style.cssText = `    \n    position: absolute;\n    top: 0;\n    left: 0;\n    right: 0;\n    bottom: 0;\n    background-color: rgba(0,0,0,0.9);\n    display: flex;\n    align-items: center;\n    justify-content: center;\n  `;\n  \n  wrapper.style.cssText = `\n    position: relative;\n    min-height: min(480px, 100vh);\n    min-width: min(640px, 100vw);\n    border-radius: 8px 8px 0 0;\n    background-color: #333333;\n  `;\n\n  video.style.cssText = \n  canvas.style.cssText = `\n    position: absolute;\n    top: 0;\n    left: 0;\n    border-radius: 8px 8px 0 0;\n  `;\n\n  content.style.cssText = `\n    display: flex;\n    flex-direction: column;\n    margin: auto;\n  `;\n\n  buttons.style.cssText = `\n    display: flex;\n    align-items: center;\n    justify-content: space-evenly;\n    min-height: 60px;\n    background-color: #333333;\n    border-radius: 0 0 8px 8px;  \n  `;\n \n  btnCapture.innerHTML = '<i class=\"fa fa-2x fa-camera\"></i>';\n  // btnCapture.title = 'Capture';\n  btnBack.innerHTML = '<i class=\"fa fa-2x fa-undo\"></i>';\n  // btnBack.title = 'Back';\n  btnSave.innerHTML = '<i class=\"fa fa-2x fa-check\"></i>';\n  // btnSave.title = 'Apply';\n  btnCancel.innerHTML = '<i class=\"fa fa-2x fa-close\"></i>';\n  // btnCancel.title = 'Cancel';\n\n  btnCapture.style.cssText =\n  btnBack.style.cssText =\n  btnSave.style.cssText =\n  btnCancel.style.cssText = `\n    padding: 10px;\n    color: #f2f2f2;\n    border: 0;\n    background: transparent;\n  `;\n\n  wrapper.append(video);\n  wrapper.append(canvas);\n  content.append(wrapper);\n  content.append(buttons);\n  container.append(content);\n\n  document.body.appendChild(container);\n\n  let hasPhoto = false;\n\n  const handleButtons = () => {\n    buttons.innerHTML = '';\n    if (hasPhoto) {\n      buttons.append(btnBack);\n      buttons.append(btnSave);\n    } else {\n      buttons.append(btnCapture);\n    }\n    buttons.append(btnCancel);\n  }\n\n  handleButtons();\n\n  function stopCamera() {\n    document.body.removeChild(container);\n\n    if (!currentMediaStream) return;\n  \n    currentMediaStream.getTracks().forEach((track) => {\n      track.stop();\n    });\n    video.srcObject = null;\n    currentMediaStream = null;\n  }\n\n  return new Promise((resolve) => {\n    btnCapture.addEventListener('click', async () => {\n      canvas.width = video.videoWidth;\n      canvas.height = video.videoHeight;\n      canvas.getContext('2d')?.drawImage(video, 0, 0, canvas.width, canvas.height);\n      hasPhoto = true;\n      handleButtons();\n    })\n\n    btnBack.addEventListener('click', () => {\n      canvas.getContext('2d')?.clearRect(0, 0, canvas.width, canvas.height);\n      hasPhoto = false;\n      handleButtons();\n    })\n\n    btnSave.addEventListener('click', async () => {\n      const uri = canvas.toDataURL('image/png');\n      const asset: Asset = { uri };\n      const result = {assets: [asset]};\n\n      if (callback) callback(result);\n      resolve(result);\n\n      stopCamera();\n    })\n    \n    btnCancel.addEventListener('click', async () => {\n      const result = {\n        assets: [],\n        didCancel: true,\n      }\n\n      if (callback) callback(result);\n      resolve(result);\n\n      stopCamera();\n    })\n  })\n}\n\nexport function imageLibrary(\n  options: ImageLibraryOptions = DEFAULT_OPTIONS,\n  callback?: Callback,\n): Promise<ImagePickerResponse> {\n  // Only supporting 'photo' mediaType for now.\n  if (options.mediaType !== 'photo') {\n    const result = {\n      errorCode: 'others' as ErrorCode,\n      errorMessage: 'For now, only photo mediaType is supported for web',\n    };\n\n    if (callback) callback(result);\n\n    return Promise.resolve(result);\n  }\n\n  const input = document.createElement('input');\n  input.style.display = 'none';\n  input.setAttribute('type', 'file');\n  input.setAttribute('accept', getWebMediaType(options.mediaType));\n\n  if (options.selectionLimit! > 1) {\n    input.setAttribute('multiple', 'multiple');\n  }\n\n  document.body.appendChild(input);\n\n  return new Promise((resolve) => {\n    const inputChangeHandler = async () => {\n      if (input.files) {\n        if (options.selectionLimit! <= 1) {\n          const img = await readFile(input.files[0], {\n            includeBase64: options.includeBase64,\n          });\n\n          const result = {assets: [img]};\n\n          if (callback) callback(result);\n\n          resolve(result);\n        } else {\n          const imgs = await Promise.all(\n            Array.from(input.files).map((file) =>\n              readFile(file, {includeBase64: options.includeBase64}),\n            ),\n          );\n\n          const result = {\n            didCancel: false,\n            assets: imgs,\n          };\n\n          if (callback) callback(result);\n\n          resolve(result);\n        }\n      }\n      cleanup();\n    };\n\n    const inputCancelHandler = async () => {\n      resolve({didCancel: true});\n      cleanup();\n    };\n\n    const cleanup = () => {\n      input.removeEventListener('change', inputChangeHandler);\n      input.removeEventListener('cancel', inputCancelHandler);\n      document.body.removeChild(input);\n    };\n\n    input.addEventListener('change', inputChangeHandler);\n    input.addEventListener('cancel', inputCancelHandler);\n\n    const event = new MouseEvent('click');\n    input.dispatchEvent(event);\n  });\n}\n\nfunction readFile(\n  targetFile: Blob,\n  options: Partial<ImageLibraryOptions>,\n): Promise<Asset> {\n  return new Promise((resolve, reject) => {\n    const reader = new FileReader();\n    reader.onerror = () => {\n      reject(\n        new Error(\n          `Failed to read the selected media because the operation failed.`,\n        ),\n      );\n    };\n    reader.onload = ({target}) => {\n      const uri = target?.result;\n\n      const returnRaw = () =>\n        resolve({\n          uri: uri as string,\n          width: 0,\n          height: 0,\n        });\n\n      if (typeof uri === 'string') {\n        const image = new Image();\n        image.src = uri;\n        image.onload = () =>\n          resolve({\n            uri,\n            width: image.naturalWidth ?? image.width,\n            height: image.naturalHeight ?? image.height,\n            // The blob's result cannot be directly decoded as Base64 without\n            // first removing the Data-URL declaration preceding the\n            // Base64-encoded data. To retrieve only the Base64 encoded string,\n            // first remove data:*/*;base64, from the result.\n            // https://developer.mozilla.org/en-US/docs/Web/API/FileReader/readAsDataURL\n            ...(options.includeBase64 && {\n              base64: uri.substr(uri.indexOf(',') + 1),\n            }),\n          });\n        image.onerror = () => returnRaw();\n      } else {\n        returnRaw();\n      }\n    };\n\n    reader.readAsDataURL(targetFile);\n  });\n}\n\nfunction getWebMediaType(mediaType: MediaType) {\n  const webMediaTypes = {\n    photo: 'image/*',\n    video: 'video/*',\n    mixed: 'image/*,video/*',\n  };\n\n  return webMediaTypes[mediaType] ?? webMediaTypes.photo;\n}\n"],"mappings":"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","ignoreList":[]}